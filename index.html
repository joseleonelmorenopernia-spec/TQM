
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nuestra Historia</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ff758c">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Historia">
    <link rel="apple-touch-icon" href="https://img.icons8.com/emoji/512/orange-heart.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; margin: 0; padding: 0; background-color: #ff758c; -webkit-tap-highlight-color: transparent; }
        .font-romantic { font-family: 'Dancing Script', cursive; }
        #loading-screen { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #ff758c 0%, #ff7eb3 100%); z-index: 9999; transition: opacity 0.5s ease-out; }
        .hidden-loader { opacity: 0; pointer-events: none; }
        @keyframes pulse-orange {
            0% { transform: scale(1); filter: drop-shadow(0 0 0px rgba(255,165,0,0)); }
            50% { transform: scale(1.1); filter: drop-shadow(0 0 20px rgba(255,165,0,0.6)); }
            100% { transform: scale(1); filter: drop-shadow(0 0 0px rgba(255,165,0,0)); }
        }
        .animate-love { animation: pulse-orange 2s infinite ease-in-out; }
        .glass { background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.2); }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slide { animation: slideUp 0.6s ease-out forwards; }
    </style>

    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.460.0?external=react",
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="loading-screen">
        <div class="flex flex-col items-center gap-6">
            <img src="https://img.icons8.com/emoji/512/orange-heart.png" class="w-24 h-24 animate-love" alt="Cargando">
            <p class="font-romantic text-3xl text-white">Nuestra Historia...</p>
        </div>
    </div>

    <div id="root"></div>

    <script type="text/babel" data-presets="typescript,react" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Heart, Calendar, Settings, Image as ImageIcon, Download, X, Share } from 'lucide-react';

        const App = () => {
            const [bg, setBg] = useState(() => localStorage.getItem('love_bg_custom') || 'linear-gradient(135deg, #ff758c 0%, #ff7eb3 100%)');
            const [activeTab, setActiveTab] = useState('home');
            const [showSettings, setShowSettings] = useState(false);
            const [showInstallGuide, setShowInstallGuide] = useState(false);
            const [deferredPrompt, setDeferredPrompt] = useState(null);
            const [isIOS, setIsIOS] = useState(false);

            useEffect(() => {
                // Registrar Service Worker
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('./sw.js')
                        .then(reg => console.log('SW Registered', reg))
                        .catch(err => console.log('SW Error', err));
                }

                // Detectar plataforma
                const isIosDevice = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
                setIsIOS(isIosDevice);

                // Capturar prompt de instalaci√≥n (Chrome/Android)
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    setDeferredPrompt(e);
                });

                // Ocultar loader
                const loader = document.getElementById('loading-screen');
                if (loader) loader.classList.add('hidden-loader');
            }, []);

            const handleInstall = async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    if (outcome === 'accepted') setDeferredPrompt(null);
                } else {
                    setShowInstallGuide(true);
                }
            };

            return (
                <div style={{ background: bg, minHeight: '100vh', transition: 'background 0.8s' }} className="flex flex-col items-center p-6 pb-32 overflow-hidden relative">
                    
                    <header className="w-full flex justify-between items-center mb-10 z-10 animate-slide">
                        <div className="flex items-center gap-3">
                            <img src="https://img.icons8.com/emoji/512/orange-heart.png" className="w-10 h-10 drop-shadow-md" alt="Logo" />
                            <h1 className="text-white text-xl font-romantic leading-none">Nuestra Historia</h1>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={handleInstall} className={`p-2.5 glass rounded-full flex items-center gap-2 transition-all active:scale-95 ${deferredPrompt ? 'bg-orange-400 text-white animate-bounce' : 'text-orange-400'}`}>
                                <Download size={20} />
                                {deferredPrompt && <span className="text-[10px] font-bold pr-1">INSTALAR</span>}
                            </button>
                            <button onClick={() => setShowSettings(true)} className="p-2.5 glass rounded-full text-white">
                                <Settings size={20} />
                            </button>
                        </div>
                    </header>

                    <main className="w-full max-w-md flex flex-col items-center flex-grow z-10">
                        {activeTab === 'home' && (
                            <div className="flex flex-col items-center gap-8 text-center animate-slide">
                                <h2 className="text-white text-4xl font-romantic drop-shadow-lg">
                                    {new Date().getDate() === 27 ? "¬°Nuestro D√≠a!" : "Te Amo"}
                                </h2>
                                <img src="https://img.icons8.com/emoji/512/orange-heart.png" className="w-32 h-32 animate-love" />
                                <div className="glass p-8 rounded-[40px] shadow-2xl">
                                    <p className="text-white text-xl font-light italic">
                                        {new Date().getMonth() === 1 && new Date().getDate() === 27 
                                            ? "Feliz aniversario mi amor y que sean muchos m√°s" 
                                            : "Cada d√≠a a tu lado es el mejor regalo."}
                                    </p>
                                </div>
                                <div className="glass px-6 py-3 rounded-2xl text-white font-bold text-lg">Pr√≥ximo 27: Cada mes</div>
                            </div>
                        )}

                        {activeTab === 'calendar' && (
                            <div className="glass p-6 rounded-[32px] w-full max-w-sm animate-slide">
                                <h3 className="text-white text-2xl font-romantic mb-6 text-center">Calendario de Amor</h3>
                                <div className="grid grid-cols-3 gap-3">
                                    {["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"].map((m, i) => (
                                        <div key={m} className={`p-3 rounded-2xl border flex flex-col items-center ${i === 1 ? 'bg-orange-500/30 border-orange-400/40' : 'bg-white/5 border-white/10'}`}>
                                            <span className="text-[10px] text-white/50 uppercase">{m}</span>
                                            <span className="text-xl font-bold text-white">27</span>
                                            {i === 1 && <span className="text-[10px]">üß°</span>}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'memories' && (
                            <div className="w-full text-center py-20 glass rounded-3xl animate-slide text-white/40">
                                <ImageIcon className="mx-auto mb-4" size={48} />
                                <p>√Ålbum de fotos disponible pronto</p>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-8 left-8 right-8 h-16 glass rounded-[24px] flex justify-around items-center z-50">
                        <button onClick={() => setActiveTab('home')} className={`p-4 ${activeTab === 'home' ? 'text-orange-400 scale-125' : 'text-white/40'}`}>
                            <Heart fill={activeTab === 'home' ? "currentColor" : "none"} size={26} />
                        </button>
                        <button onClick={() => setActiveTab('calendar')} className={`p-4 ${activeTab === 'calendar' ? 'text-white scale-125' : 'text-white/40'}`}>
                            <Calendar size={26} />
                        </button>
                        <button onClick={() => setActiveTab('memories')} className={`p-4 ${activeTab === 'memories' ? 'text-white scale-125' : 'text-white/40'}`}>
                            <ImageIcon size={26} />
                        </button>
                    </nav>

                    {/* Gu√≠a de Instalaci√≥n */}
                    {showInstallGuide && (
                        <div className="fixed inset-0 z-[200] bg-black/80 backdrop-blur-md flex items-center justify-center p-6">
                            <div className="bg-white rounded-[32px] p-8 max-w-xs w-full animate-slide text-center relative">
                                <button onClick={() => setShowInstallGuide(false)} className="absolute top-4 right-4 text-gray-400"><X /></button>
                                <img src="https://img.icons8.com/emoji/512/orange-heart.png" className="w-16 h-16 mx-auto mb-4" />
                                <h3 className="text-pink-600 font-bold text-xl mb-4">Instalar App</h3>
                                <div className="text-left space-y-4 text-sm text-gray-600">
                                    {isIOS ? (
                                        <>
                                            <p>1. Toca el bot√≥n de <b>Compartir</b> <Share className="inline w-4 h-4"/> abajo.</p>
                                            <p>2. Busca <b>"A√±adir a pantalla de inicio"</b>.</p>
                                            <p>3. Pulsa <b>A√±adir</b> arriba a la derecha.</p>
                                        </>
                                    ) : (
                                        <>
                                            <p>1. Toca los <b>3 puntos</b> ‚ãÆ arriba a la derecha.</p>
                                            <p>2. Selecciona <b>"Instalar aplicaci√≥n"</b>.</p>
                                            <p>3. Confirma la instalaci√≥n.</p>
                                        </>
                                    )}
                                </div>
                                <button onClick={() => setShowInstallGuide(false)} className="mt-6 w-full bg-pink-500 text-white py-3 rounded-xl font-bold">Entendido üß°</button>
                            </div>
                        </div>
                    )}

                    {/* Ajustes */}
                    {showSettings && (
                        <div className="fixed inset-0 z-[100] bg-black/40 backdrop-blur-sm flex items-end">
                            <div className="w-full bg-white rounded-t-[40px] p-8 animate-slide">
                                <div className="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-8" onClick={() => setShowSettings(false)}></div>
                                <h4 className="text-pink-600 font-bold text-center mb-6 uppercase text-xs">Fondo de la App</h4>
                                <div className="grid grid-cols-4 gap-4 mb-8">
                                    {['linear-gradient(135deg, #ff758c 0%, #ff7eb3 100%)', '#1a1a1a', '#ff9a9e', '#a18cd1'].map(c => (
                                        <button key={c} onClick={() => { setBg(c); localStorage.setItem('love_bg_custom', c); }} className="aspect-square rounded-2xl border-2 border-white shadow-md" style={{ background: c }} />
                                    ))}
                                </div>
                                <button onClick={() => setShowSettings(false)} className="w-full bg-pink-500 text-white py-4 rounded-xl font-bold">Hecho</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
